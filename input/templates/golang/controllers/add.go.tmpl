package {{.EntityName}}_controllers

import (
	"net/http"
	{{.EntityName}} "github.com/bakeable/bkry/internal/server/models/entities/{{.EntityName}}"
	{{.EntityName}}_operations "github.com/bakeable/bkry/internal/server/transport/operations/{{.EntityName}}"
	"github.com/bakeable/bkry/tools"

	"github.com/gin-gonic/gin"
)

//// THIS FILE IS AUTOGENERATED. DO NOT EDIT
//// IF YOU WISH TO EDIT THIS CONTROLLER, REMOVE THE .gen.go EXTENSION
//// THIS WAY, IT WON'T BE OVERWRITTEN AND THERE WON'T BE A CONTROLLER GENERATED

func Add(c *gin.Context) {
{{range .ParentsCamelCase}}
	// Get {{.}} ID from URL
	{{.}}ID := c.Param("{{.}}ID")
{{end}}

	// Get {{.TypeName}} mapping from request body
	var mapping map[string]interface{}
	if err := c.ShouldBindJSON(&mapping); err != nil {
		c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
		return
	}

	// Decode JSON to {{.TypeName}}
	entity := {{.EntityName}}.Decode(mapping)

	// Create {{.TypeName}}
	id := {{.EntityName}}_operations.Save(getRepository(), {{if gt (len .ParentVars) 0}}{{.ParentVars}}, {{end}}entity, utils.GetEditorId(c))

	// Return collected item ID
	c.JSON(http.StatusCreated, gin.H{"id": id})

}